<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Discount Recorder</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: #f0f2f5; 
            padding: 20px; 
            margin: 0;
            display: flex;
            justify-content: center; 
        }

        .container { 
            background: white; 
            padding: 25px; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
            width: 100%;
            max-width: 500px;
        }

        h2 { text-align: center; color: #2c3e50; margin-bottom: 25px; }
        
        .form-group { margin-bottom: 18px; position: relative; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #34495e; }
        
        input[type="number"], input[type="text"] { 
            width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; 
            font-size: 16px; box-sizing: border-box; 
        }
        
        .result-field { background-color: #f8f9fa; color: #2c3e50; font-weight: bold; }
        hr { border: 0; border-top: 1px solid #eee; margin: 25px 0; }

        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 30px; }
        
        button { 
            width: 100%; padding: 14px; border: none; border-radius: 10px; 
            cursor: pointer; font-size: 16px; font-weight: 600; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        
        .btn-save { background-color: #007bff; color: white; }
        .btn-view { background-color: #6c757d; color: white; }
        .camera-btn { background-color: #ffc107; color: #333; }
        
        /* åœ–ç‰‡é è¦½å€ */
        #preview-container { 
            margin-top: 10px; text-align: center; border: 2px dashed #cbd5e0; 
            padding: 10px; border-radius: 10px; min-height: 120px; 
            display: flex; align-items: center; justify-content: center; 
            background-color: #f8f9fa;
        }
        #preview-img { max-width: 100%; max-height: 250px; display: none; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* --- ä¿®æ­£ç›¸æ©ŸæŒ‰éˆ•çš„é—œéµ CSS --- */
        /* ä¸ä½¿ç”¨ display: noneï¼Œè€Œæ˜¯å°‡å®ƒè®Šé€æ˜ä¸¦æ”¾åˆ°æŒ‰éˆ•ä¸‹æ–¹ï¼Œç¢ºä¿èƒ½è¢«è§¸ç™¼ */
        #cameraInput {
            opacity: 0;
            position: absolute;
            z-index: -1;
            width: 1px; 
            height: 1px;
        }

        .loading { display: none; text-align: center; color: #007bff; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>Discount Recorder<br><span style="font-size: 0.7em; color: #7f8c8d; font-weight: normal;">(å•†æ¥­æŠ˜æ‰£è¨ˆç®—ç´€éŒ„)</span></h2>

    <div class="form-group">
        <label>1. Cost ($ æˆæœ¬)</label>
        <input type="number" id="cost" placeholder="Enter Cost" oninput="calculate()">
    </div>

    <div class="form-group">
        <label>2. Discount (% æŠ˜æ‰£)</label>
        <input type="number" id="discount" placeholder="e.g. 20" oninput="calculate()">
    </div>

    <hr>

    <div class="form-group">
        <label>3. Final Price ($ æŠ˜å¾Œé‡‘é¡)</label>
        <input type="text" id="finalPrice" class="result-field" readonly>
    </div>

    <div class="form-group">
        <label>4. Saved Amount ($ å„ªæƒ é‡‘é¡)</label>
        <input type="text" id="savedAmount" class="result-field" readonly>
    </div>

    <div class="form-group">
        <label>5. Photo (å•†å“æ‹ç…§)</label>
        
        <button type="button" class="camera-btn" onclick="triggerCamera()">
            ğŸ“· Take Photo (æ‹ç…§/é¸åœ–)
        </button>
        
        <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="previewImage(this)">
        
        <div id="preview-container">
            <span id="placeholder-text" style="color:#aaa">No Image (ç„¡åœ–ç‰‡)</span>
            <img id="preview-img">
        </div>
    </div>

    <div class="btn-group">
        <button type="button" class="btn-save" id="saveBtn" onclick="saveToGoogle()">
            ğŸ’¾ Save to Cloud (å­˜æª”è‡³é›²ç«¯)
        </button>
        <button type="button" class="btn-view" onclick="viewExcel()">
            ğŸ“Š View Excel (æª¢è¦– Excel)
        </button>
    </div>
    
    <div class="loading" id="loadingMsg">Uploading... (ä¸Šå‚³ä¸­...)</div>
</div>

<script>
    // ==========================================
    // è«‹å¡«å…¥ä½ çš„ç¶²å€
    const SCRIPT_URL = 'è«‹è²¼ä¸Šä½ çš„_APPS_SCRIPT_ç¶²å€';
    const SHEET_VIEW_URL = 'è«‹è²¼ä¸Šä½ çš„_GOOGLE_SHEET_ç¶²å€';
    // ==========================================

    let base64Image = "";

    function calculate() {
        let cost = parseFloat(document.getElementById('cost').value);
        let discount = parseFloat(document.getElementById('discount').value);
        if (!isNaN(cost) && !isNaN(discount)) {
            let final = cost * (1 - (discount / 100));
            document.getElementById('finalPrice').value = Math.round(final);
            document.getElementById('savedAmount').value = Math.round(cost - final);
        } else {
            document.getElementById('finalPrice').value = "";
            document.getElementById('savedAmount').value = "";
        }
    }

    // è§¸ç™¼ç›¸æ©Ÿçš„å‡½å¼
    function triggerCamera() {
        document.getElementById('cameraInput').click();
    }

    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('preview-img').src = e.target.result;
                document.getElementById('preview-img').style.display = 'block';
                document.getElementById('placeholder-text').style.display = 'none';
                base64Image = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function saveToGoogle() {
        let cost = document.getElementById('cost').value;
        let discount = document.getElementById('discount').value;
        let final = document.getElementById('finalPrice').value;
        let saved = document.getElementById('savedAmount').value;

        if(!cost || !discount) {
            alert("Please enter data! (è«‹è¼¸å…¥è³‡æ–™)"); return;
        }

        document.getElementById('saveBtn').disabled = true;
        document.getElementById('saveBtn').innerText = "Uploading...";
        document.getElementById('loadingMsg').style.display = 'block';

        let data = { cost: cost, discount: discount, finalPrice: final, savedAmount: saved, image: base64Image };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(data)
        })
        .then(r => r.json())
        .then(res => {
            alert("âœ… Success! (æˆåŠŸ)");
            resetForm();
        })
        .catch(e => alert("âŒ Error (éŒ¯èª¤)"))
        .finally(() => {
            document.getElementById('saveBtn').disabled = false;
            document.getElementById('saveBtn').innerText = "ğŸ’¾ Save to Cloud (å­˜æª”è‡³é›²ç«¯)";
            document.getElementById('loadingMsg').style.display = 'none';
        });
    }

    function viewExcel() {
        if(SHEET_VIEW_URL.includes("http")) window.open(SHEET_VIEW_URL, '_blank');
        else alert("Setup URL first! (è«‹è¨­å®šç¶²å€)");
    }

    function resetForm() {
        document.getElementById('cost').value = "";
        document.getElementById('discount').value = "";
        document.getElementById('finalPrice').value = "";
        document.getElementById('savedAmount').value = "";
        document.getElementById('cameraInput').value = ""; 
        document.getElementById('preview-img').style.display = 'none';
        document.getElementById('placeholder-text').style.display = 'block';
        base64Image = "";
    }
</script>

</body>
</html>
